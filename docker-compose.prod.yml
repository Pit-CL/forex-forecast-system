version: "3.8"

services:
  # 7-day USD/CLP forecaster - runs daily at 08:00 Chile time via cron
  forecaster-7d:
    build:
      context: .
      dockerfile: Dockerfile.7d.prod
    container_name: usdclp-forecaster-7d
    environment:
      - ENVIRONMENT=production
      - REPORT_TIMEZONE=America/Santiago
      - TZ=America/Santiago
      - FRED_API_KEY=${FRED_API_KEY}
      - NEWS_API_KEY=${NEWS_API_KEY}
      - GMAIL_USER=${GMAIL_USER}
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD}
      - EMAIL_RECIPIENTS=${EMAIL_RECIPIENTS}
    volumes:
      - ./data:/app/data
      - ./output:/app/output
      - ./reports:/app/reports
      - ./logs:/app/logs
      - ./.env:/app/.env:ro
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # 15-day USD/CLP forecaster - runs on day 1 and 15 at 09:00 Chile time via cron
  forecaster-15d:
    build:
      context: .
      dockerfile: Dockerfile.15d.prod
    container_name: usdclp-forecaster-15d
    environment:
      - ENVIRONMENT=production
      - REPORT_TIMEZONE=America/Santiago
      - TZ=America/Santiago
      - FRED_API_KEY=${FRED_API_KEY}
      - NEWS_API_KEY=${NEWS_API_KEY}
      - GMAIL_USER=${GMAIL_USER}
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD}
      - EMAIL_RECIPIENTS=${EMAIL_RECIPIENTS}
    volumes:
      - ./data:/app/data
      - ./output:/app/output
      - ./reports:/app/reports
      - ./logs:/app/logs
      - ./.env:/app/.env:ro
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # 30-day USD/CLP forecaster - runs on day 1 at 09:30 Chile time via cron
  forecaster-30d:
    build:
      context: .
      dockerfile: Dockerfile.30d.prod
    container_name: usdclp-forecaster-30d
    environment:
      - ENVIRONMENT=production
      - REPORT_TIMEZONE=America/Santiago
      - TZ=America/Santiago
      - FRED_API_KEY=${FRED_API_KEY}
      - NEWS_API_KEY=${NEWS_API_KEY}
      - GMAIL_USER=${GMAIL_USER}
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD}
      - EMAIL_RECIPIENTS=${EMAIL_RECIPIENTS}
    volumes:
      - ./data:/app/data
      - ./output:/app/output
      - ./reports:/app/reports
      - ./logs:/app/logs
      - ./.env:/app/.env:ro
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # 90-day USD/CLP forecaster - runs on day 1 at 10:00 Chile time via cron
  forecaster-90d:
    build:
      context: .
      dockerfile: Dockerfile.90d.prod
    container_name: usdclp-forecaster-90d
    environment:
      - ENVIRONMENT=production
      - REPORT_TIMEZONE=America/Santiago
      - TZ=America/Santiago
      - FRED_API_KEY=${FRED_API_KEY}
      - NEWS_API_KEY=${NEWS_API_KEY}
      - GMAIL_USER=${GMAIL_USER}
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD}
      - EMAIL_RECIPIENTS=${EMAIL_RECIPIENTS}
    volumes:
      - ./data:/app/data
      - ./output:/app/output
      - ./reports:/app/reports
      - ./logs:/app/logs
      - ./.env:/app/.env:ro
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  data:
    driver: local
  output:
    driver: local
  logs:
    driver: local

networks:
  default:
    name: forex-forecast-network

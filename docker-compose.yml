version: '3.8'

services:
  # 7-day USD/CLP forecaster - runs daily at 08:00 Chile time
  forecaster-7d:
    build:
      context: .
      dockerfile: Dockerfile.7d
    container_name: usdclp-forecaster-7d
    environment:
      - ENVIRONMENT=production
      - REPORT_TIMEZONE=America/Santiago
      - FRED_API_KEY=${FRED_API_KEY}
      - NEWS_API_KEY=${NEWS_API_KEY}
      - GMAIL_USER=${GMAIL_USER}
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD}
      - EMAIL_RECIPIENTS=${EMAIL_RECIPIENTS}
    volumes:
      - ./data:/app/data
      - ./output:/app/output
      - ./logs:/app/logs
      - ./.env:/app/.env:ro
    restart: unless-stopped
    # Run manually or via cron on host
    profiles:
      - manual

  # 12-month USD/CLP forecaster - runs monthly on 1st day at 09:00 Chile time
  forecaster-12m:
    build:
      context: .
      dockerfile: Dockerfile.12m
    container_name: usdclp-forecaster-12m
    environment:
      - ENVIRONMENT=production
      - REPORT_TIMEZONE=America/Santiago
      - FRED_API_KEY=${FRED_API_KEY}
      - NEWS_API_KEY=${NEWS_API_KEY}
      - GMAIL_USER=${GMAIL_USER}
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD}
      - EMAIL_RECIPIENTS=${EMAIL_RECIPIENTS}
    volumes:
      - ./data:/app/data
      - ./output:/app/output
      - ./logs:/app/logs
      - ./.env:/app/.env:ro
    restart: unless-stopped
    profiles:
      - manual

  # Importer report - runs monthly on 10th day at 10:00 Chile time
  importer-report:
    build:
      context: .
      dockerfile: Dockerfile.importer
    container_name: usdclp-importer-report
    environment:
      - ENVIRONMENT=production
      - REPORT_TIMEZONE=America/Santiago
      - FRED_API_KEY=${FRED_API_KEY}
      - NEWS_API_KEY=${NEWS_API_KEY}
      - GMAIL_USER=${GMAIL_USER}
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD}
      - EMAIL_RECIPIENTS=${EMAIL_RECIPIENTS}
    volumes:
      - ./data:/app/data
      - ./output:/app/output
      - ./logs:/app/logs
      - ./.env:/app/.env:ro
    restart: unless-stopped
    profiles:
      - manual

volumes:
  data:
    driver: local
  output:
    driver: local
  logs:
    driver: local

networks:
  default:
    name: forex-forecast-network
